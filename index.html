<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>V-Bucks コード生成</title>
</head>
<body>

<form id="vbucksForm">
    <label>V-Bucks数:</label>
    <select id="amount">
        <option value="1000">1000 V-Bucks</option>
        <option value="2800">2800 V-Bucks</option>
        <option value="5000">5000 V-Bucks</option>
        <option value="13500">13500 V-Bucks</option>
    </select>

    <label>Epic Gamesディスプレイネーム:</label>
    <input type="text" id="username" placeholder="ディスプレイネームを入力" required>

    <label>プラットフォーム:</label>
    <select id="platform">
        <option value="pc">PC</option>
        <option value="psn">PlayStation</option>
        <option value="xbl">Xbox</option>
        <option value="switch">Nintendo Switch</option>
        <option value="mobile">Mobile</option>
    </select>

    <button type="submit">生成</button>
</form>

<div id="result"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    console.log('Script loaded'); // スクリプトが正しく読み込まれているか確認

    document.getElementById('vbucksForm').addEventListener('submit', async (event) => {
        event.preventDefault(); // フォーム送信を防ぐ
        console.log('Form submitted'); // イベントが発火しているか確認
        await checkAccount();
    });

    async function checkAccount() {
        const username = document.getElementById('username').value;
        const platform = document.getElementById('platform').value;
        const apiKey = 'efd36bf0-bab7-4117-baed-339806428ca6';

        if (!username) {
            alert('ディスプレイネームを入力してください');
            return;
        }

        const url = `https://api.fortnitetracker.com/v1/profile/${platform}/${username}`;

        try {
            const response = await fetch(url, {
                headers: {
                    'TRN-Api-Key': apiKey
                }
            });

            if (!response.ok) {
                throw new Error('アカウントが見つかりません');
            }

            if (Math.random() < 1/3) {
                const code = generateRandomCode();
                displayResult(`成功しました！<br>生成コード: <strong>${code}</strong>`);
            } else {
                displayResult('生成に失敗しました。');
            }
        } catch (error) {
            displayResult(`エラー: ${error.message}`);
        }
    }

    function generateRandomCode() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let code = '';
        for (let i = 0; i < 16; i++) {
            if (i > 0 && i % 4 === 0) code += '-';
            code += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return code;
    }

    function displayResult(message) {
        const result = document.getElementById('result');
        result.innerHTML = message;
        result.style.opacity = 0;
        setTimeout(() => {
            result.style.opacity = 1;
        }, 100);
    }
});
</script>

</body>
</html>
